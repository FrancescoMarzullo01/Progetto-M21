<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>

<!--  Refresh pagina ogni 30 secondi  -->
<meta charset="UTF-8" http-equiv="refresh" content="30">

<title>Online Delivery Services @Progetto-M21</title>

<link rel="icon" href="/images/favicons/favicon.ico">

<link rel="stylesheet" href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://getbootstrap.com/docs/4.0/examples/cover/cover.css">
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

<script src="/JS/notification.js" type="text/javascript"></script>

</head>

<body class="text-center">



	<div class="cover-container d-flex h-100 p-3 mx-auto flex-column">
		<!--  NAVBAR -->
		<header th:replace="fragments/components:: navbar"></header>


		<!--  PRINCIPALE -->
		<main role="main" class="inner cover">


			<!--  Gestione Tracking code errato -->
			<div th:if="${error}" class="alert alert-danger">
				<p th:text="${error}"></p>
			</div>



			<th:block th:each="order : ${listOrders}">
				<td th:switch="${#strings.toString(order.deliveryDetails.deliveryStatus)}">


					<!--  NOTIFICA CUSTOMER  -->
					<span th:case="'DELIVERED'" sec:authorize="hasAnyAuthority('CUSTOMER')">


						<script th:inline="javascript">
							var orderId = /*[[${order.orderDetailsId}]]*/'';
							customerNotification(orderId);
						</script>

					</span>


					<!--  NOTIFICA COURIER  -->
					<span th:case="'WITHDRAWN'" sec:authorize="hasAnyAuthority('COURIER')">
						<script th:inline="javascript">
							var orderId = /*[[${order.orderDetailsId}]]*/'';
							courierNotification(orderId);
						</script>
					</span>

				</td>
			</th:block>

			<div class="text-left">
				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">First Name:</li>
					<li class="list-inline-item" th:text="${#authentication.getPrincipal().getUser().getFirstName()}">First Name</li>
				</ul>

				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">Last Name:</li>
					<li class="list-inline-item" th:text="${#authentication.getPrincipal().getUser().getLastName()}">Last Name</li>
				</ul>

				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">Email:</li>
					<li class="list-inline-item" sec:authentication="name">Username</li>
				</ul>

				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">Registration date:</li>
					<li class="list-inline-item">-------</li>
					<!--  					<li class="list-inline-item" th:text="${#authentication.getPrincipal().getUser().getRegistrationDate()}">Date</li>
					 -->
				</ul>

				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">User type:</li>
					<li class="list-inline-item" sec:authentication="principal.authorities">Roles</li>
				</ul>

				<a th:href="@{/Orders}" class="btn btn-success" role="button" aria-pressed="true">Your orders</a>


				<div sec:authorize="hasAnyAuthority('CUSTOMER')" style="margin-top: 5em;">

					<h2>Add order to profile</h2>

					<form th:action="@{/add}" method="get">
						<div class="form-group">
							<input type="text" th:name="tracking" th:placeholder="Tracking" class="form-control" required="required"
								autofocus="autofocus" />
						</div>
						<button type="submit" class="btn btn-primary btn-lg btn-block" aria-pressed="true">Add</button>
					</form>

				</div>


			</div>


		</main>

		<!--  FOOTER -->
		<footer th:replace="fragments/components:: footer"> </footer>

	</div>



	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://getbootstrap.com/docs/4.0/assets/js/vendor/popper.min.js"></script>
	<script src="https://getbootstrap.com/docs/4.0/dist/js/bootstrap.min.js"></script>

</body>
</html>