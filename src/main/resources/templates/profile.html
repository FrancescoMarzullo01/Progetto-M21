<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>

<!--  Refresh pagina ogni 30 secondi  -->
<!-- meta charset="UTF-8" http-equiv="refresh" content="30"> -->
<meta charset="UTF-8">

<title>Online Delivery Services @Progetto-M21</title>

<link rel="icon" href="/images/favicons/favicon.ico">

<link rel="stylesheet" href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://getbootstrap.com/docs/4.0/examples/cover/cover.css">
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

<script src="/JS/notification.js" type="text/javascript"></script>

<style>
th {
	background: #3d414a;
	border: solid;
	border-color: grey;
	width: 35%;
}

tr {
	line-height: 14px;
}
</style>



</head>



<body>



	<div class="cover-container d-flex h-100 p-3 mx-auto flex-column">
		<!--  NAVBAR -->
		<header th:replace="fragments/components:: navbar"></header>


		<!--  PRINCIPALE -->
		<main role="main" class="inner cover">


			<!--  Gestione Tracking code errato -->
			<div th:if="${error}" class="alert alert-danger">
				<p th:text="${error}"></p>
			</div>



			<th:block th:each="order : ${listOrders}">
				<td th:switch="${#strings.toString(order.deliveryDetails.deliveryStatus)}">


					<!--  NOTIFICA CUSTOMER  -->
					<span th:case="'DELIVERED'" sec:authorize="hasAnyAuthority('CUSTOMER')">


						<script th:inline="javascript">
							var orderId = /*[[${order.orderDetailsId}]]*/'';
							customerNotification(orderId);
						</script>

					</span>


					<!--  NOTIFICA COURIER  -->
					<span th:case="'WITHDRAWN'" sec:authorize="hasAnyAuthority('COURIER')">
						<script th:inline="javascript">
							var orderId = /*[[${order.orderDetailsId}]]*/'';
							courierNotification(orderId);
						</script>
					</span>

				</td>
			</th:block>

			<h1 style="margin-bottom: 15px;">Personal Data</h1>
			<table class="table table-dark" style="text-align: left;">

				<tbody>
					<tr>
						<th>First Name</th>
						<td th:text="${#authentication.getPrincipal().getUser().getFirstName()}"></td>
					</tr>

					<tr>
						<th>Last Name</th>
						<td th:text="${#authentication.getPrincipal().getUser().getLastName()}"></td>
					</tr>

					<tr>
						<th>Email</th>
						<td sec:authentication="name"></td>
					</tr>

					<tr>
						<th>Registration date</th>
						<td th:text="${#authentication.getPrincipal().getUser().getRegistrationDate()} ?: 'null'"></td>
					</tr>

					<tr>
						<th>User type</th>
						<td sec:authentication="principal.authorities"></td>
					</tr>
				</tbody>
			</table>
			<!-- 
			<div class="text-left">
				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">First Name:</li>
					<li class="list-inline-item" th:text="${#authentication.getPrincipal().getUser().getFirstName()}">First Name</li>
				</ul>

				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">Last Name:</li>
					<li class="list-inline-item" th:text="${#authentication.getPrincipal().getUser().getLastName()}">Last Name</li>
				</ul>

				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">Email:</li>
					<li class="list-inline-item" sec:authentication="name">Username</li>
				</ul>

				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">Registration date:</li>
					<li class="list-inline-item" th:text="${#authentication.getPrincipal().getUser().getRegistrationDate()} ?: 'null'">Date</li>

				</ul>

				<ul class="list-inline">
					<li class="list-inline-item" style="font-weight: bold;">User type:</li>
					<li class="list-inline-item" sec:authentication="principal.authorities">Roles</li>
				</ul>
-->
			<a th:href="@{/Orders}" sec:authorize="hasAnyAuthority('CUSTOMER', 'COURIER')" class="btn btn-success btn-lg"
				role="button" aria-pressed="true" style="display: block; margin-top: 20px;">Your orders</a>

			<div sec:authorize="hasAnyAuthority('ADMINISTRATOR')" style="margin-top: 4em">
				<h1 style="margin-bottom: 15px; text-align: left;">Upload Orders</h1>
				<form th:action="@{/uploadFile}" enctype="multipart/form-data" method="post">
					<div class="input-group">
						<div class="custom-file">
							<input type="file" class="custom-file-input" th:name="file" id="customFile">
							<label class="custom-file-label" for="customFile">Choose file</label>
						</div>
						<div class="input-group-append">
							<button class="btn btn-primary" type="submit" id="myInput">Upload</button>
						</div>

					</div>
				</form>
			</div>

			<a th:href="@{/Orders}" sec:authorize="hasAnyAuthority('ADMINISTRATOR')" class="btn btn-lg btn-success" role="button"
				aria-pressed="true" style="display: block; margin-bottom: 15px; margin-top: 30px;">All orders</a>
			<a th:href="@{/register}" sec:authorize="hasAnyAuthority('ADMINISTRATOR')" class="btn btn-lg btn-success"
				role="button" aria-pressed="true" style="display: block; margin-bottom: 15px;">Add User</a>
			<a th:href="@{/UserList}" sec:authorize="hasAnyAuthority('ADMINISTRATOR')" class="btn btn-lg btn-success"
				role="button" aria-pressed="true" style="display: block;">User List</a>



			<div sec:authorize="hasAnyAuthority('CUSTOMER')" style="margin-top: 3em;">

				<h2>Add order to profile</h2>

				<form th:action="@{/add}" method="get">
					<div class="form-group">
						<input type="text" th:name="tracking" th:placeholder="Tracking" class="form-control" required="required"
							autofocus="autofocus" />
					</div>
					<button type="submit" class="btn btn-primary btn-lg btn-block" aria-pressed="true">Add</button>
				</form>

			</div>



		</main>

		<!--  FOOTER -->
		<footer th:replace="fragments/components:: footer"> </footer>

	</div>



	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://getbootstrap.com/docs/4.0/assets/js/vendor/popper.min.js"></script>
	<script src="https://getbootstrap.com/docs/4.0/dist/js/bootstrap.min.js"></script>
	<script>
		document
				.querySelector('.custom-file-input')
				.addEventListener(
						'change',
						function(e) {
							var fileName = document
									.getElementById("customFile").files[0].name;
							var nextSibling = e.target.nextElementSibling
							nextSibling.innerText = fileName
						})
	</script>
</body>
</html>